<!DOCTYPE html>
<html lang="fa">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="./style.css">
  <title>Ø³ÛŒØ³ØªÙ… Ú©Ø§Ù…Ù†Øª</title>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§</h1>
      <div class="subtitle">Ù†Ø¸Ø±Ø§Øª Ùˆ Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§</div>
    </div>

    <div class="form-section">
      <form id="commentForm">
        <textarea id="commentText" placeholder="Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." required></textarea>
        <button type="submit">Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±</button>
      </form>
    </div>

    <div class="comments-section">
      <h2>Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§:</h2>
      <ul id="commentsList">
        <div class="empty-state">
          <div class="empty-icon">ğŸ’¬</div>
          <p>Ù‡Ù†ÙˆØ² Ù†Ø¸Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§ÙˆÙ„ÛŒÙ† Ù†Ø¸Ø± Ø±Ø§ Ø´Ù…Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯!</p>
        </div>
      </ul>
    </div>
  </div>

  <script>
    const form = document.getElementById('commentForm');
    const commentsList = document.getElementById('commentsList');

    // ØªØ§Ø¨Ø¹: Ú¯Ø±ÙØªÙ† Ù‡Ù…Ù‡ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§
    async function loadComments() {
      const res = await fetch('http://localhost:3000/comments');
      const data = await res.json();

      if (data.length === 0) {
        commentsList.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ’¬</div>
            <p>Ù‡Ù†ÙˆØ² Ù†Ø¸Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§ÙˆÙ„ÛŒÙ† Ù†Ø¸Ø± Ø±Ø§ Ø´Ù…Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯!</p>
          </div>
        `;
        return;
      }

      commentsList.innerHTML = '';
      data.forEach(comment => {
        const li = document.createElement('li');
        li.className = 'comment-item';
        
        const date = new Date(comment.createdAt);
        const formattedDate = new Intl.DateTimeFormat('fa-IR', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }).format(date);
        
        li.innerHTML = `
          <div class="comment-text">${comment.text}</div>
          <div class="comment-meta">
            <span class="comment-time">${formattedDate}</span>
          </div>
        `;
        
        commentsList.appendChild(li);
      });
    }

    // ØªØ§Ø¨Ø¹: Ø§Ø±Ø³Ø§Ù„ Ú©Ø§Ù…Ù†Øª Ø¬Ø¯ÛŒØ¯
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = document.getElementById('commentText').value;

      const res = await fetch('http://localhost:3000/comments', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ text })
      });

      const data = await res.json();
      console.log('Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯:', data);

      document.getElementById('commentText').value = '';
      loadComments();
    });

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§
    loadComments();
  </script>
</body>

</html>